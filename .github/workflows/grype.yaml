# .github/workflows/grype.yaml
name: üì¶ DevSecOps - Dependency Scan (Grype SCA)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  grype_scan:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        
      - name: üîé Run Grype Dependency Scan (SCA)
        uses: anchore/scan-action@v6
        id: scan
        continue-on-error: true # Keep this to ensure the report upload runs
        with:
          path: "."
          output-format: json 
          # FIX: Replaced 'fail-on-severity' with the correct parameter 'severity-cutoff'
          severity-cutoff: high

      - name: üì§ Print Grype Report Content
        # This step now runs because the previous step is allowed to fail
        run: |
          echo "--- START GRYPE REPORT ---"
          # The scan action saves the file to the path in the output variable
          cat ${{ steps.scan.outputs.output-file }} 
          echo "--- END GRYPE REPORT ---"
          
      - name: ‚¨ÜÔ∏è Upload Grype Report Artifact
        uses: actions/upload-artifact@v4
        with:
          name: grype-security-report
          path: ${{ steps.scan.outputs.output-file }}
# .github/workflows/grype.yaml
name: üì¶ DevSecOps - Dependency Scan (Grype SCA)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  grype_scan:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        
      # ... (The Install Grype CLI step is here) ...
      
      - name: üîé Run Grype Scan and Suppress Failure
        # The scan is run, and the '|| true' ensures the step succeeds despite findings.
        run: |
          grype dir:. -o json --file grype-report.json 
        # --fail-on high || true

      - name: üì§ Print and Upload Grype Report
        run: |
          # 1. Print the content to the log for immediate viewing
          echo "--- START GRYPE REPORT ---"
          cat grype-report.json
          echo "--- END GRYPE REPORT ---"
          
          # 2. Use the Upload Artifact action directly in the shell
          # NOTE: This uses the upload-artifact action as a separate, subsequent step.
          # We revert the logic to two separate, forced-success steps.
          
      - name: ‚¨ÜÔ∏è Upload Grype Report Artifact
        uses: actions/upload-artifact@v4
        with:
          name: grype-security-report
          path: grype-report.json